<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Report - {{ student.Name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
        <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @media print {
            .no-print { display: none !important; }
            .container { max-width: 100% !important; }
        }
        .topic-card {
            border-left: 4px solid #007bff;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
        }
        .topic-card:hover {
            border-left-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,123,255,0.15);
        }
        .progress-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            position: relative;
            overflow: hidden;
        }
        .progress-circle::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
        }
        .score-excellent { background: linear-gradient(135deg, #28a745, #20c997); }
        .score-good { background: linear-gradient(135deg, #17a2b8, #007bff); }
        .score-average { background: linear-gradient(135deg, #ffc107, #fd7e14); }
        .score-poor { background: linear-gradient(135deg, #dc3545, #e83e8c); }
        
        /* Subject tabs styling */
        .nav-tabs .nav-link {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
            color: #495057;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .nav-tabs .nav-link:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            border-color: #adb5bd;
        }
        .nav-tabs .nav-link.active {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            border-color: #007bff;
            color: white;
        }
        .tab-content {
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 0.375rem 0.375rem;
            background: white;
            position: relative;
            overflow: hidden;
        }
        
        /* Ensure only active tab content is visible */
        .tab-pane {
            display: none !important;
            opacity: 0;
            visibility: hidden;
        }
        
        .tab-pane.active {
            display: block !important;
            opacity: 1;
            visibility: visible;
        }
        
        .tab-pane.show.active {
            display: block !important;
            opacity: 1;
            visibility: visible;
        }
        
        /* Force hide non-active tabs */
        .tab-pane:not(.active) {
            display: none !important;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 15px;
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .report-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px 15px 0 0;
        }
        
        .topic-badge {
            font-size: 0.9rem;
            padding: 8px 12px;
            border-radius: 20px;
        }
        
        .performance-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        /* Chart container styling */
        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            width: 100%;
            min-height: 400px;
        }
        
        .chart-container canvas {
            width: 100% !important;
            height: 400px !important;
        }
        
        .chart-container > div {
            width: 100%;
            height: 100%;
        }
        
        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container mt-4">
        <!-- Header with Back Button -->
        <div class="row no-print mb-4">
            <div class="col-12">
                <a href="/" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Search
                </a>
                <button onclick="window.print()" class="btn btn-primary float-end">
                    <i class="fas fa-print me-2"></i>Print Report
                </button>
            </div>
        </div>

        <!-- Report Card -->
        <div class="card shadow-lg border-0">
            <!-- Header -->
            <div class="card-header report-header text-white text-center py-5">
                <h1 class="mb-3 fw-bold">
                    <i class="fas fa-chart-line me-3"></i>
                    Academic Performance Report
                </h1>
                <p class="mb-0 fs-5 opacity-90">Topic-wise Assessment & Analytics</p>
            </div>

            <!-- Student Information -->
            <div class="card-body p-4">
                {% if student.subjects %}
                    {# Multi-subject calculations #}
                    {% set total_topics = 0 %}
                    {% set total_marks = 0 %}
                    {% set total_time_numeric = 0 %}
                    {% set has_numeric_time = false %}
                    {% for subject_name, subject_data in student.subjects.items() %}
                        {% set total_topics = total_topics + subject_data.topics|length %}
                        {% for topic in subject_data.topics %}
                            {% set total_marks = total_marks + (topic.marks|float) %}
                            {% if topic.time_category and topic.time_category.replace('.','').isdigit() %}
                                {% set total_time_numeric = total_time_numeric + (topic.time_category|float) %}
                                {% set has_numeric_time = true %}
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                    {% set avg_marks = (total_marks / total_topics) if total_topics > 0 else 0 %}
                {% else %}
                    {# Single subject calculations (backward compatibility) #}
                    {% set total_topics = student.topics|length %}
                    {% set total_marks = 0 %}
                    {% set total_time_numeric = 0 %}
                    {% set has_numeric_time = false %}
                    {% for topic in student.topics %}
                        {% set total_marks = total_marks + (topic.marks|float) %}
                        {% if topic.time and topic.time.replace('.','').isdigit() %}
                            {% set total_time_numeric = total_time_numeric + (topic.time|float) %}
                            {% set has_numeric_time = true %}
                        {% endif %}
                    {% endfor %}
                    {% set avg_marks = (total_marks / total_topics) if total_topics > 0 else 0 %}
                {% endif %}
                
                <div class="row mb-5">
                    <div class="col-lg-8">
                        <h2 class="text-primary border-bottom pb-3 mb-4">
                            <i class="fas fa-user-graduate me-2"></i>Student Information
                        </h2>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="fw-bold text-muted">Student Name</label>
                                    <div class="fs-5 fw-bold text-dark">{{ student.Name }}</div>
                                </div>
                                <div class="mb-3">
                                    <label class="fw-bold text-muted">Roll Number</label>
                                    <div class="fs-5 fw-bold text-dark">{{ student['Roll Number'] }}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="fw-bold text-muted">Class</label>
                                    <div class="fs-5 fw-bold text-dark">{{ student.Class }}</div>
                                </div>
                                <div class="mb-3">
                                    <label class="fw-bold text-muted">Total Topics</label>
                                    <div class="fs-5 fw-bold text-dark">{{ total_topics }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 text-center">
                        <div class="progress-circle score-{% if avg_marks >= 10 %}excellent{% elif avg_marks >= 8 %}good{% elif avg_marks >= 6 %}average{% else %}poor{% endif %} mx-auto">
                            <div>
                                <div style="font-size: 1.5rem;">{{ "%.1f"|format(avg_marks) }}</div>
                                <small>Avg Score</small>
                            </div>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">Overall Performance</small>
                        </div>
                    </div>
                </div>

                <!-- Summary Statistics -->
                <div class="row mb-5">
                    <div class="col-md-3 col-6 mb-3">
                        <div class="card metric-card text-white text-center border-0 shadow">
                            <div class="card-body p-4">
                                <i class="fas fa-list-ol fa-2x mb-3 opacity-75"></i>
                                <h3 class="fw-bold">{{ total_topics }}</h3>
                                <p class="mb-0 opacity-90">Total Topics</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="card text-white text-center border-0 shadow" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                            <div class="card-body p-4">
                                <i class="fas fa-clock fa-2x mb-3 opacity-75"></i>
                                {% if has_numeric_time %}
                                    <h3 class="fw-bold">{{ "%.0f"|format(total_time_numeric) }}</h3>
                                    <p class="mb-0 opacity-90">Total Minutes</p>
                                {% else %}
                                    <h3 class="fw-bold">{{ total_topics }}</h3>
                                    <p class="mb-0 opacity-90">Time Categories</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="card text-white text-center border-0 shadow" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="card-body p-4">
                                <i class="fas fa-trophy fa-2x mb-3 opacity-75"></i>
                                <h3 class="fw-bold">{{ "%.1f"|format(total_marks) }}</h3>
                                <p class="mb-0 opacity-90">Total Score</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="card text-white text-center border-0 shadow" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">
                            <div class="card-body p-4">
                                <i class="fas fa-chart-line fa-2x mb-3 opacity-75"></i>
                                <h3 class="fw-bold">{{ "%.1f"|format(avg_marks) }}</h3>
                                <p class="mb-0 opacity-90">Average Score</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Topic-wise Performance -->
                <div class="row mb-5">
                    <div class="col-12">
                        <h2 class="text-primary border-bottom pb-3 mb-4">
                            <i class="fas fa-tasks me-2"></i>Topic-wise Performance
                        </h2>
                        
                        {% if student.subjects %}
                        <!-- Multi-subject layout with tabs -->
                        <ul class="nav nav-tabs" id="subjectTabs" role="tablist">
                            {% for subject_name, subject_data in student.subjects.items() %}
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" 
                                        id="{{ subject_name|lower }}-tab" 
                                        data-bs-target="#{{ subject_name|lower }}" 
                                        type="button" 
                                        role="tab" 
                                        aria-controls="{{ subject_name|lower }}" 
                                        aria-selected="false">
                                    <i class="fas fa-{% if subject_name == 'Maths' %}calculator{% elif subject_name == 'Science' %}flask{% else %}book{% endif %} me-2"></i>
                                    {{ subject_name }}
                                </button>
                            </li>
                            {% endfor %}
                        </ul>
                        
                        <div class="tab-content p-4" id="subjectTabContent">
                            {% for subject_name, subject_data in student.subjects.items() %}
                            <div class="tab-pane fade" 
                                 id="{{ subject_name|lower }}" 
                                 role="tabpanel" 
                                 aria-labelledby="{{ subject_name|lower }}-tab">
                                
                                {% if subject_data.topics %}
                                <div class="row">
                                    {% for topic in subject_data.topics %}
                                    {% set marks_num = topic.marks|float %}
                                    <div class="col-lg-6 col-md-12 mb-4">
                                        <div class="card topic-card h-100 border-0 shadow-sm">
                                            <div class="card-body p-4">
                                                <div class="d-flex justify-content-between align-items-start mb-3">
                                                    <h5 class="card-title mb-0 fw-bold">
                                                        <i class="fas fa-book me-2 text-primary"></i>
                                                        {{ topic.name }}
                                                    </h5>
                                                    <span class="topic-badge {{ topic.performance_class }}">
                                                        {{ topic.marks }}
                                                    </span>
                                                </div>
                                                
                                                <div class="row mb-3">
                                                    <div class="col-6">
                                                        <div class="d-flex align-items-center">
                                                            <i class="fas fa-clock text-info me-2"></i>
                                                            <div>
                                                                <small class="text-muted d-block">Time Category</small>
                                                                <span class="fw-bold {% if 'below' in topic.time_category.lower() %}text-success{% else %}text-warning{% endif %}">
                                                                    {{ topic.time_category }}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <div class="d-flex align-items-center">
                                                            <i class="fas fa-star text-warning me-2"></i>
                                                            <div>
                                                                <small class="text-muted d-block">Score</small>
                                                                <span class="fw-bold">{{ topic.marks }}/12</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Rank Display -->
                                                <div class="row mb-3">
                                                    <div class="col-12">
                                                        <div class="d-flex align-items-center justify-content-center">
                                                            <i class="fas fa-trophy text-success me-2"></i>
                                                            <div class="text-center">
                                                                <small class="text-muted d-block">Class Rank</small>
                                                                <span class="fw-bold fs-5 text-primary">
                                                                    {% if topic.rank != 'N/A' %}
                                                                        #{{ topic.rank }}
                                                                    {% else %}
                                                                        Not Ranked
                                                                    {% endif %}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Progress bar based on marks out of 12 -->
                                                <div class="mb-2">
                                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                                        <small class="text-muted">Performance</small>
                                                        <small class="text-muted">{{ ((marks_num / 12) * 100)|round|int }}%</small>
                                                    </div>
                                                    <div class="progress" style="height: 8px; border-radius: 10px;">
                                                        <div class="progress-bar {{ topic.performance_class }}" 
                                                             style="width: {{ ((marks_num / 12) * 100)|round }}%; border-radius: 10px;"></div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Performance indicator -->
                                                <div class="mt-2">
                                                    <span class="performance-indicator {{ topic.performance_class }}"></span>
                                                    <small class="text-muted">{{ topic.performance_text }}</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                
                                <!-- Subject-specific Performance Analysis -->
                                {% set subject_strong_topics = subject_data.topics|selectattr('color', 'equalto', 'green')|list %}
                                {% set subject_need_attention_topics = subject_data.topics|selectattr('color', 'equalto', 'orange')|list %}
                                {% set subject_weak_topics = subject_data.topics|selectattr('color', 'equalto', 'red')|list %}
                                
                                <div class="row mt-4">
                                    <div class="col-12">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-body p-4">
                                                <h5 class="card-title">
                                                    <i class="fas fa-chart-bar me-2 text-primary"></i>
                                                    {{ subject_name }} Performance Analysis
                                                </h5>
                                                
                                                <!-- Performance Overview for this subject -->
                                                <div class="row mb-4">
                                                    <div class="col-md-6">
                                                        <h6 class="text-muted mb-3">Performance Overview</h6>
                                                        {% if subject_strong_topics|length > subject_need_attention_topics|length and subject_strong_topics|length > subject_weak_topics|length %}
                                                            <div class="alert alert-success border-0 shadow-sm">
                                                                <i class="fas fa-trophy me-2"></i>
                                                                <strong>Good Going!</strong><br>
                                                                <small>Strong performance in {{ subject_name }} with efficient learning patterns.</small>
                                                            </div>
                                                        {% elif subject_need_attention_topics|length > subject_strong_topics|length and subject_need_attention_topics|length > subject_weak_topics|length %}
                                                            <div class="alert alert-warning border-0 shadow-sm">
                                                                <i class="fas fa-exclamation-triangle me-2"></i>
                                                                <strong>Need Attention.</strong><br>
                                                                <small>Good scores in {{ subject_name }} but work on time efficiency.</small>
                                                            </div>
                                                        {% elif subject_weak_topics|length > 0 %}
                                                            <div class="alert alert-danger border-0 shadow-sm">
                                                                <i class="fas fa-flag me-2"></i>
                                                                <strong>Need Immediate Attention.</strong><br>
                                                                <small>Focus on strengthening {{ subject_name }} fundamentals.</small>
                                                            </div>
                                                        {% else %}
                                                            <div class="alert alert-info border-0 shadow-sm">
                                                                <i class="fas fa-info-circle me-2"></i>
                                                                <strong>Getting Started.</strong><br>
                                                                <small>Continue working on {{ subject_name }} topics.</small>
                                                            </div>
                                                        {% endif %}
                                                        
                                                        <!-- Category breakdown for this subject -->
                                                        <div class="mt-3">
                                                            <h6 class="text-muted mb-2">{{ subject_name }} Category Breakdown:</h6>
                                                            <div class="row text-center">
                                                                <div class="col-4">
                                                                    <div class="text-success fw-bold">{{ subject_strong_topics|length }}</div>
                                                                    <small class="text-muted">Strong</small>
                                                                </div>
                                                                <div class="col-4">
                                                                    <div class="text-warning fw-bold">{{ subject_need_attention_topics|length }}</div>
                                                                    <small class="text-muted">Need Attention</small>
                                                                </div>
                                                                <div class="col-4">
                                                                    <div class="text-danger fw-bold">{{ subject_weak_topics|length }}</div>
                                                                    <small class="text-muted">Weak</small>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="col-md-6">
                                                        <h6 class="text-muted mb-3">{{ subject_name }} Topic Analysis</h6>
                                                        
                                                        <!-- Strong Topics for this subject -->
                                                        <div class="mb-3">
                                                            <h6 class="text-success mb-2">
                                                                <i class="fas fa-star me-1"></i>Strong Topics ({{ subject_strong_topics|length }})
                                                            </h6>
                                                            {% if subject_strong_topics %}
                                                                <div class="d-flex flex-wrap gap-1">
                                                                    {% for topic in subject_strong_topics %}
                                                                        <span class="badge bg-success-subtle text-success border border-success-subtle px-2 py-1">
                                                                            {{ topic.name.replace('Topic ', 'T') }} ({{ "%.0f"|format(topic.score_percentage) }}%)
                                                                        </span>
                                                                    {% endfor %}
                                                                </div>
                                                                <small class="text-muted d-block mt-1">High scores (>75%) with efficient time</small>
                                                            {% else %}
                                                                <small class="text-muted">No strong topics in {{ subject_name }} yet</small>
                                                            {% endif %}
                                                        </div>
                                                        
                                                        <!-- Need Attention Topics for this subject -->
                                                        <div class="mb-3">
                                                            <h6 class="text-warning mb-2">
                                                                <i class="fas fa-exclamation-circle me-1"></i>Need Attention ({{ subject_need_attention_topics|length }})
                                                            </h6>
                                                            {% if subject_need_attention_topics %}
                                                                <div class="d-flex flex-wrap gap-1">
                                                                    {% for topic in subject_need_attention_topics %}
                                                                        <span class="badge bg-warning-subtle text-warning border border-warning-subtle px-2 py-1">
                                                                            {{ topic.name.replace('Topic ', 'T') }} ({{ "%.0f"|format(topic.score_percentage) }}%)
                                                                        </span>
                                                                    {% endfor %}
                                                                </div>
                                                                <small class="text-muted d-block mt-1">Good scores but slow completion time</small>
                                                            {% else %}
                                                                <small class="text-muted">No topics need attention in {{ subject_name }}</small>
                                                            {% endif %}
                                                        </div>
                                                        
                                                        <!-- Weak Topics for this subject -->
                                                        <div class="mb-3">
                                                            <h6 class="text-danger mb-2">
                                                                <i class="fas fa-times-circle me-1"></i>Weak Topics ({{ subject_weak_topics|length }})
                                                            </h6>
                                                            {% if subject_weak_topics %}
                                                                <div class="d-flex flex-wrap gap-1">
                                                                    {% for topic in subject_weak_topics %}
                                                                        <span class="badge bg-danger-subtle text-danger border border-danger-subtle px-2 py-1">
                                                                            {{ topic.name.replace('Topic ', 'T') }} ({{ "%.0f"|format(topic.score_percentage) }}%)
                                                                        </span>
                                                                    {% endfor %}
                                                                </div>
                                                                <small class="text-muted d-block mt-1">Scores â‰¤75% - need focused practice</small>
                                                            {% else %}
                                                                <small class="text-muted">No weak topics in {{ subject_name }}</small>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Progress Chart for this subject -->
                                <div class="row mt-4">
                                    <div class="col-12">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-body p-4">
                                                <h5 class="card-title">
                                                    <i class="fas fa-chart-line me-2 text-primary"></i>
                                                    {{ subject_name }} Progress Tracker
                                                </h5>
                                                <p class="text-muted small mb-3">Track your performance improvement across {{ subject_name }} topics</p>
                                                
                                <div class="chart-container">
                                    <div style="position: relative; height: 400px; width: 100%;">
                                        <canvas id="{{ subject_name|lower }}ProgressChart"></canvas>
                                    </div>
                                </div>                                                    <div class="chart-legend">
                                                        <div class="legend-item">
                                                            <div class="legend-color" style="background: #007bff;"></div>
                                                            <span>Score Progression</span>
                                                        </div>
                                                        <div class="legend-item">
                                                            <div class="legend-color" style="background: #28a745;"></div>
                                                            <span>Target (75%)</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% else %}
                                <div class="alert alert-info border-0 shadow-sm">
                                    <i class="fas fa-info-circle me-2"></i>
                                    No topic data available for {{ subject_name }}.
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        
                        {% else %}
                        <div class="alert alert-warning border-0 shadow-sm">
                            <i class="fas fa-info-circle me-2"></i>
                            No topic data available for this student.
                        </div>
                        {% endif %}
                    </div>
                </div>

            </div>
        </div>

        <!-- Footer -->
        <div class="card-footer bg-light text-center py-4 border-0">
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-1"><strong>Report Generated:</strong></p>
                    <p class="text-muted">{{ report_time.strftime('%B %d, %Y at %I:%M %p') }}</p>
                </div>
                <div class="col-md-6">
                    <p class="mb-1"><strong>Academic Session:</strong></p>
                    <p class="text-muted">2025-26</p>
                </div>
            </div>
            <hr class="my-3">
            <p class="mb-0 text-muted small">
                <i class="fas fa-info-circle me-1"></i>
                This is a computer-generated report based on topic-wise assessment data. 
                For any queries, please contact the academic office.
            </p>
        </div>
    </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Tab functionality and Chart initialization -->
    <script>
        // Chart data from server
        window.chartData = {
            {% if student.subjects %}
            {% for subject_name, subject_data in student.subjects.items() %}
            '{{ subject_name }}': {
                labels: [
                    {% for topic in subject_data.topics %}
                    '{{ topic.name }}'{% if not loop.last %},{% endif %}
                    {% endfor %}
                ],
                values: [
                    {% for topic in subject_data.topics %}
                    {{ topic.marks|default(0) }}{% if not loop.last %},{% endif %}
                    {% endfor %}
                ]
            }{% if not loop.last %},{% endif %}
            {% endfor %}
            {% endif %}
        };
        
        // Function to create Chart.js charts
        function createProgressChart(canvasId, subjectName, labels, data) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) {
                console.error('Canvas not found:', canvasId);
                return;
            }
            
            // Define colors based on performance
            const pointColors = data.map(value => {
                if (value >= 9) return '#28a745'; // Green for good performance
                if (value >= 6) return '#ffc107'; // Yellow for average
                return '#dc3545'; // Red for needs improvement
            });
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: subjectName + ' Progress',
                        data: data,
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: pointColors,
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 8,
                        pointHoverRadius: 10,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: subjectName + ' Progress Chart',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 12,
                            title: {
                                display: true,
                                text: 'Marks',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Topics',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            console.log('Chart created successfully for:', subjectName);
        }
        
        // Initialize tabs and charts
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize first tab as active
            const firstTabButton = document.querySelector('#subjectTabs .nav-link:first-child');
            const firstTabPane = document.querySelector('#subjectTabContent .tab-pane:first-child');
            
            if (firstTabButton && firstTabPane) {
                firstTabButton.classList.add('active');
                firstTabPane.classList.add('active', 'show');
            }
            
            // Add click event listeners to tab buttons
            document.querySelectorAll('#subjectTabs .nav-link').forEach(function(button) {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all tabs and panes
                    document.querySelectorAll('#subjectTabs .nav-link').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('#subjectTabContent .tab-pane').forEach(pane => {
                        pane.classList.remove('active', 'show');
                    });
                    
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Show corresponding tab pane
                    const targetId = this.getAttribute('data-bs-target').substring(1);
                    const targetPane = document.getElementById(targetId);
                    if (targetPane) {
                        targetPane.classList.add('active', 'show');
                    }
                });
            });
            
            // Initialize charts
            setTimeout(() => {
                for (const [subjectName, chartData] of Object.entries(window.chartData)) {
                    const canvasId = subjectName.toLowerCase() + 'ProgressChart';
                    createProgressChart(canvasId, subjectName, chartData.labels, chartData.values);
                }
            }, 500);
        });
    </script>
</body>
</html>